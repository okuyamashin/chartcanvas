# パーセンテージ形式の検討

## 問題

Y軸がパーセンテージの場合、データの形式をどうするか：

1. **0から1の値（0.0〜1.0）**
   - 例: `[0.25, 0.5, 0.75, 0.9]` → 25%, 50%, 75%, 90%

2. **0から100の値（0〜100）**
   - 例: `[25, 50, 75, 90]` → 25%, 50%, 75%, 90%

3. **2つの数字（分子と分母）**
   - 例: 分子 `[25, 50, 75, 90]`、分母 `[100, 100, 100, 100]`
   - 自動的に計算: `25/100 = 25%`, `50/100 = 50%`, `75/100 = 75%`, `90/100 = 90%`

## 各アプローチの比較

### 0から1の値（0.0〜1.0）

#### メリット
- **数学的・統計学的に標準的**
  - 確率、比率などで一般的に使用される形式
  - 0.0〜1.0は標準的な正規化された値

- **計算が簡単**
  - 他の値との掛け算が直感的
  - 例: `0.5 * 1000 = 500`

- **データベースやAPIで一般的**
  - 多くのシステムで0.0〜1.0が標準
  - JSONやAPIレスポンスでよく見る形式

- **精度が高い**
  - 小数点以下を扱える（例: 0.123 = 12.3%）

#### デメリット
- **表示時に変換が必要**
  - データを100倍して%記号を付ける必要がある
  - 例: `0.5` → `50%`

- **ユーザーにとって直感的でない可能性**
  - 一般的なユーザーは「50%」の方が「0.5」より理解しやすい

- **整数値との混在が難しい**
  - 他のデータが整数の場合、形式が統一されない

### 0から100の値（0〜100）

#### メリット
- **ユーザーにとって直感的**
  - 「50」は「50%」として理解しやすい
  - 表示時の変換が不要（そのまま%記号を付けるだけ）

- **表示が簡単**
  - データをそのまま表示して%記号を付けるだけ
  - 例: `50` → `50%`

- **整数値との統一**
  - 他のデータも整数の場合、形式が統一される

- **手動入力が簡単**
  - ユーザーが手動でデータを入力する場合、50と入力する方が0.5より簡単

#### デメリット
- **計算がやや複雑**
  - 他の値との掛け算で100で割る必要がある
  - 例: `50 * 1000 / 100 = 500`

- **精度の問題**
  - 整数値のみ（小数点以下を扱う場合は50.5など）

- **統計学的には非標準**
  - 0.0〜1.0の方が標準的

### 2つの数字（分子と分母）

#### メリット
- **データ提供が簡単**
  - データ提供側がパーセンテージを計算する必要がない
  - 生の数値（分子と分母）を送るだけで良い
  - 例: 売上データなら `売上数` と `目標数` を送るだけ

- **ゼロ除算の心配がない**
  - データ提供側で分母が0のデータを送らないようにするだけ
  - ChartCanvas側でゼロ除算の処理を実装する必要がない

- **柔軟性が高い**
  - 各データポイントで分母が異なる場合にも対応可能
  - 例: `分子: [25, 50, 75]`, `分母: [100, 200, 300]` → `25%, 25%, 25%`

- **データの意味が明確**
  - 分子と分母の意味が明確（例: 実績/目標、成功/総数）
  - データの解釈がしやすい

- **計算の透明性**
  - パーセンテージの計算過程が明確
  - デバッグや検証がしやすい

#### デメリット
- **APIが複雑になる**
  - 2つの配列を渡す必要がある
  - 例: `setData(numerators, denominators)` または `setData({ numerators: [...], denominators: [...] })`

- **データの形式が変わる**
  - 通常の数値データとは異なる形式
  - 既存のコードとの互換性の問題

- **エラーハンドリングが必要**
  - 分子と分母の配列の長さが一致しない場合
  - 分母が0の場合（データ提供側で防ぐ前提だが、念のため）

#### 使用例
```javascript
// 分子と分母を別々に指定
lineChart.setData([25, 50, 75, 90], [100, 100, 100, 100]);
// → 自動的に計算: 25%, 50%, 75%, 90%
// → Y軸ラベル: 0%, 10%, 20%, ..., 100%

// または、オブジェクト形式
lineChart.setData({
    numerators: [25, 50, 75, 90],
    denominators: [100, 100, 100, 100]
});

// 各データポイントで分母が異なる場合
lineChart.setData([25, 50, 75], [100, 200, 300]);
// → 自動的に計算: 25%, 25%, 25%
```

## 検討事項

### 判定方法

どちらの形式を採用する場合でも、パーセンテージとして判定する方法が必要：

#### 案1: データの範囲で自動判定
- **0〜1の範囲:** 0.0〜1.0の値として扱い、100倍して%表示
- **0〜100の範囲:** 0〜100の値として扱い、そのまま%表示
- **問題点:** データが0.5と50が混在する場合の判定が難しい

#### 案2: ユーザーが明示的に指定
- `setYAxisType('percentage')` のようなメソッドで指定
- データ形式も指定: `setYAxisType('percentage', { format: '0-1' })` または `{ format: '0-100' }`
- **問題点:** APIが複雑になる

#### 案3: デフォルトを決めて、オプションで変更
- デフォルトは0〜100（ユーザーにとって直感的）
- 0〜1の場合はオプションで指定可能
- **問題点:** デフォルトの選択が重要

## 決定事項

### 採用方針

**決定:** 複数のデータ形式をサポートし、デフォルトは0.0〜1.0の形式とする

#### 基本方針
1. **デフォルト形式: 0.0〜1.0（0から1の値）**
   - 数学的・統計学的に標準的な形式
   - データベースやAPIで一般的
   - 精度が高い（小数点以下を扱える）

2. **複数の形式をサポート**
   - 0.0〜1.0の値（デフォルト）
   - 0〜100の値（オプション）
   - 分子と分母の形式（オプション）

3. **パーセンテージの判定**
   - パーセンテージかどうかは自動判定可能
   - または、ユーザーが明示的に指定可能

### 使用例

#### デフォルト: 0.0〜1.0の値
```javascript
// デフォルト: 0.0〜1.0の値として扱う
lineChart.setData([0.25, 0.5, 0.75, 0.9]);
// → 自動的にパーセンテージと判定（0.0〜1.0の範囲）
// → Y軸ラベル: 0%, 10%, 20%, ..., 100%
// → データ表示: 25%, 50%, 75%, 90%
```

#### 0〜100の値（オプション）
```javascript
// 0〜100の値の場合、明示的に指定
lineChart.setYAxisType('percentage', { format: '0-100' });
lineChart.setData([25, 50, 75, 90]);
// → 25を25%として表示
// → Y軸ラベル: 0%, 10%, 20%, ..., 100%
```

#### 分子と分母の形式（オプション）
```javascript
// 分子と分母を別々に指定
lineChart.setData([25, 50, 75, 90], [100, 100, 100, 100]);
// → 自動的に計算: 25%, 50%, 75%, 90%
// → Y軸ラベル: 0%, 10%, 20%, ..., 100%

// または、オブジェクト形式
lineChart.setData({
    numerators: [25, 50, 75, 90],
    denominators: [100, 100, 100, 100]
});

// 各データポイントで分母が異なる場合
lineChart.setData([25, 50, 75], [100, 200, 300]);
// → 自動的に計算: 25%, 25%, 25%
```

### 判定方法

#### パーセンテージの自動判定
- データの範囲に基づいて自動判定
  - **0.0〜1.0の範囲:** パーセンテージとして扱い、100倍して%表示
  - **0〜100の範囲:** パーセンテージとして扱い、そのまま%表示
- または、ユーザーが明示的に指定
  - `setYAxisType('percentage', { format: '0-1' })` または `{ format: '0-100' }`

#### データ形式の判定
- データの渡し方に応じて自動判定
  - 単一配列: 0.0〜1.0または0〜100の値
  - 2つの配列: 分子と分母の形式
  - オブジェクト: `{ numerators: [...], denominators: [...] }` の形式

## 実装の優先順位

### Phase 1: 基本実装（最優先）
1. **デフォルト形式: 0.0〜1.0のサポート**
   - 0.0〜1.0の値をパーセンテージとして扱う
   - データを100倍して%表示
   - Y軸ラベル: 0%, 10%, 20%, ..., 100%（10%刻み）

2. **パーセンテージの自動判定**
   - データの範囲に基づいて自動判定（0.0〜1.0の範囲）
   - または、ユーザーが明示的に指定可能

### Phase 2: 0〜100の形式のサポート
1. 0〜100の値のサポート
2. オプションで形式を指定可能
   - `setYAxisType('percentage', { format: '0-100' })`

### Phase 3: 分子と分母の形式のサポート
1. 分子と分母を別々に指定するAPI
2. 自動的にパーセンテージを計算
3. エラーハンドリング（配列の長さ不一致、分母が0など）

## 注意事項

- **一貫性が重要**
  - どちらの形式を採用する場合でも、一貫した動作が必要
  - ユーザーが混乱しないように、明確な仕様が必要

- **互換性**
  - 既存のデータやAPIとの互換性を考慮
  - 他のライブラリやツールとの互換性

- **ユーザビリティ**
  - 一般的なユーザーにとって理解しやすい形式を優先
  - 手動入力のしやすさも考慮

- **2つの数字（分子と分母）の方式**
  - データ提供側の負担が軽い
  - ゼロ除算の心配がない
  - ただし、APIが複雑になる可能性がある
  - 通常の数値データとの区別が必要

