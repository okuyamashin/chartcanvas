# 日付範囲とモード

## 概要

日付がX軸に並ぶのは**棒グラフ**と**線グラフ**です。`LineChart`クラス（および`BarChart`クラス）では、X軸の日付範囲を**最初の日と最後の日**を指定するだけで設定できます。

内部で期間を計算し、期間に応じて自動的に最適なモードを選択します。

## API仕様

### `setDateRange(startDate, endDate)`

最初の日と最後の日を指定して、X軸の日付範囲を設定します。

**パラメータ:**
- `startDate` (string | Date): 開始日
  - 文字列形式: `'YYYY-MM-DD'`（例: `'2024-01-01'`）
  - Dateオブジェクト: `new Date(2024, 0, 1)`
- `endDate` (string | Date): 終了日
  - 文字列形式: `'YYYY-MM-DD'`（例: `'2024-12-31'`）
  - Dateオブジェクト: `new Date(2024, 11, 31)`

**戻り値:** `LineChart`インスタンス（チェーンメソッド対応）

## モードの自動切り替え

期間に応じて、以下のモードが自動的に選択されます：

### 1ヶ月モード
**条件:** 期間が1ヶ月以内

**表示形式:**
```
2025/10/01 02 03 04 05 06 07 08 09 10 11 12 13 14 15 ...
```

**特徴:**
- 年/月を大きく表示（例: `2025/10`）
- その月の日を横に並べて表示（例: `01 02 03 04 05 06 07 08 09 10 11 12 ...`）
- すべて通常のフォントサイズ
- 2行構造: 1行目に年/月、2行目に日

**例:**
```javascript
lineChart.setDateRange('2025-10-01', '2025-10-31');
// → 1ヶ月モードに自動切り替え
```

### 3ヶ月モード
**条件:** 期間が60日〜120日（約3ヶ月）

**表示形式:**
- 最初の日と最後の日は必ず表示
- それ以外は月初の1日と日曜日のみを表示
- 例: `2024/11/01`（最初の日）、`03`（日曜日）、`10`（日曜日）、`17`（日曜日）、`24`（日曜日）、`12/01`（月初の1日）、`08`（日曜日）、...、`2025/01/31`（最後の日）

**特徴:**
- 最初の日と最後の日は必ず表示される
- 月初の1日（例: `12/01`、`01/01`）は必ず表示される
- 日曜日も表示される（週の区切りが明確になる）
- ラベルが多すぎることを防ぎ、読みやすさを保つ

**例:**
```javascript
lineChart.setDateRange('2024-11-01', '2025-01-31');
// → 3ヶ月モードに自動切り替え（60日〜120日の範囲）
```

### 1年モード
**条件:** 期間が120日超（約1年）

**表示形式:**
- 最初の日と最後の日は必ず表示
- それ以外は月初の1日のみを表示（月毎）
- 例: `2025/01/01`（最初の日）、`02/01`（2月の月初）、`03/01`（3月の月初）、...、`12/01`（12月の月初）、`12/31`（最後の日）

**特徴:**
- 最初の日と最後の日は必ず表示される
- 各月の月初の1日のみを表示（月毎の区切りが明確になる）
- 日曜日の条件は適用されない（1年データでは月初の1日のみ）
- ラベルが多すぎることを防ぎ、読みやすさを保つ

**例:**
```javascript
lineChart.setDateRange('2025-01-01', '2025-12-31');
// → 1年モードに自動切り替え（120日超の範囲）
```

### 1年以上モード
**条件:** 期間が1年超

**表示形式:**
```
2020/01 02 03 04 05 06 07 08 09 10 11 12 2021/01 02 03 04 ...
```

**特徴:**
- 最初の年/月だけ通常のフォントサイズ（例: `2020/01`）
- 残りの月/日は小さなフォントサイズ（例: `02 03 04 05 06 07 08 09 10 11 12`）
- 次の年の最初の月は再び通常サイズ（例: `2021/01`）
- ラベルが被ることを防ぎ、スペースを節約しつつ読みやすくする
- 2行構造: 1行目に年、2行目に月

**例:**
```javascript
lineChart.setDateRange('2020-01-01', '2023-12-31');
// → 1年以上モードに自動切り替え
```

## モード判定のロジック

期間の計算方法:
1. `endDate - startDate` で日数を計算
2. 日数に基づいてモードを判定:
   - 60日未満 → 全日付を表示（7日間、1ヶ月など）
   - 60日〜120日 → 3ヶ月モード（最初の日・最後の日 + 月初の1日と日曜日）
   - 120日超 → 1年モード（最初の日・最後の日 + 月初の1日のみ）

**実装詳細:**
- **7日間・1ヶ月（60日未満）:** 全日付を表示（変更なし）
- **3ヶ月（60日〜120日）:** 
  - 最初の日と最後の日は必ず表示
  - それ以外は月初の1日と日曜日のみを表示
- **1年（120日超）:** 
  - 最初の日と最後の日は必ず表示
  - それ以外は月初の1日のみを表示（月毎）

**注意:** 
- 月の日数は異なるため、単純な日数計算ではなく、カレンダーを考慮した計算が必要
- 例: 1月1日〜1月31日は1ヶ月、1月1日〜2月1日は1ヶ月超

## 使用例

```javascript
const chart_div = document.getElementById('chart_div');
const chart = new ChartCanvas(chart_div);
chart.size(1024, 600);

const lineChart = chart.addLineChart();

// 日付範囲を設定（内部で自動的にモードを選択）
lineChart.setDateRange('2024-01-01', '2024-12-31');
// → 1年モードに自動切り替え

// データを設定
lineChart.setData([100, 150, 200, 180, 250, ...]);

chart.render();
```

## メリット

1. **シンプルなAPI**
   - 最初の日と最後の日を指定するだけ
   - ラベルの配列を生成する必要がない

2. **自動最適化**
   - 期間に応じて最適な表示モードを自動選択
   - ユーザーが手動でモードを選択する必要がない

3. **一貫性**
   - 同じ期間なら常に同じ表示形式
   - 予測可能な動作

4. **保守性**
   - モード判定ロジックを内部に隠蔽
   - 将来的にモードを追加・変更しやすい

## 実装の優先順位

1. **Phase 1: 基本実装**
   - `setDateRange()`メソッドの実装
   - 期間計算ロジック
   - モード判定ロジック

2. **Phase 2: 各モードの実装**
   - 1ヶ月モード
   - 1年モード
   - 1年以上モード

3. **Phase 3: 3ヶ月モード**
   - 3ヶ月モードの詳細設計と実装

4. **Phase 4: カスタマイズ**
   - モードの手動指定（オプション）
   - モード判定の閾値の調整（オプション）

