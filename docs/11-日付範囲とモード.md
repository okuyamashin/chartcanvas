# 日付範囲とモード

## 概要

日付がX軸に並ぶのは**棒グラフ**と**線グラフ**です。`LineChart`クラス（および`BarChart`クラス）では、X軸の日付範囲を**最初の日と最後の日**を指定するだけで設定できます。

内部で期間を計算し、期間に応じて自動的に最適なモードを選択します。

## API仕様

### `setDateRange(startDate, endDate)`

最初の日と最後の日を指定して、X軸の日付範囲を設定します。

**パラメータ:**
- `startDate` (string | Date): 開始日
  - 文字列形式: `'YYYY-MM-DD'`（例: `'2024-01-01'`）
  - Dateオブジェクト: `new Date(2024, 0, 1)`
- `endDate` (string | Date): 終了日
  - 文字列形式: `'YYYY-MM-DD'`（例: `'2024-12-31'`）
  - Dateオブジェクト: `new Date(2024, 11, 31)`

**戻り値:** `LineChart`インスタンス（チェーンメソッド対応）

## モードの自動切り替え

期間に応じて、以下のモードが自動的に選択されます：

### 1ヶ月モード
**条件:** 期間が1ヶ月以内

**表示形式:**
```
2025/10/01 02 03 04 05 06 07 08 09 10 11 12 13 14 15 ...
```

**特徴:**
- 年/月を大きく表示（例: `2025/10`）
- その月の日を横に並べて表示（例: `01 02 03 04 05 06 07 08 09 10 11 12 ...`）
- すべて通常のフォントサイズ
- 2行構造: 1行目に年/月、2行目に日

**例:**
```javascript
lineChart.setDateRange('2025-10-01', '2025-10-31');
// → 1ヶ月モードに自動切り替え
```

### 3ヶ月モード
**条件:** 期間が1ヶ月超〜3ヶ月以内

**表示形式:**
（詳細は要検討）
- おそらく月単位での表示
- 例: `2024/01 02 03` のような形式

**例:**
```javascript
lineChart.setDateRange('2024-01-01', '2024-03-31');
// → 3ヶ月モードに自動切り替え
```

### 1年モード
**条件:** 期間が3ヶ月超〜1年以内

**表示形式:**
```
2024/01 02 03 04 05 06 07 08 09 10 11 12
```

**特徴:**
- 年を大きく表示（例: `2024`）
- その年の月を横に並べて表示（例: `01 02 03 04 05 06 07 08 09 10 11 12`）
- すべて通常のフォントサイズ
- 2行構造: 1行目に年、2行目に月

**例:**
```javascript
lineChart.setDateRange('2024-01-01', '2024-12-31');
// → 1年モードに自動切り替え
```

### 1年以上モード
**条件:** 期間が1年超

**表示形式:**
```
2020/01 02 03 04 05 06 07 08 09 10 11 12 2021/01 02 03 04 ...
```

**特徴:**
- 最初の年/月だけ通常のフォントサイズ（例: `2020/01`）
- 残りの月/日は小さなフォントサイズ（例: `02 03 04 05 06 07 08 09 10 11 12`）
- 次の年の最初の月は再び通常サイズ（例: `2021/01`）
- ラベルが被ることを防ぎ、スペースを節約しつつ読みやすくする
- 2行構造: 1行目に年、2行目に月

**例:**
```javascript
lineChart.setDateRange('2020-01-01', '2023-12-31');
// → 1年以上モードに自動切り替え
```

## モード判定のロジック

期間の計算方法（要検討）:
1. `endDate - startDate` で日数を計算
2. 日数に基づいてモードを判定:
   - 1ヶ月以内 → 1ヶ月モード
   - 1ヶ月超〜3ヶ月以内 → 3ヶ月モード
   - 3ヶ月超〜1年以内 → 1年モード
   - 1年超 → 1年以上モード

**注意:** 
- 月の日数は異なるため、単純な日数計算ではなく、カレンダーを考慮した計算が必要
- 例: 1月1日〜1月31日は1ヶ月、1月1日〜2月1日は1ヶ月超

## 使用例

```javascript
const chart_div = document.getElementById('chart_div');
const chart = new ChartCanvas(chart_div);
chart.size(1024, 600);

const lineChart = chart.addLineChart();

// 日付範囲を設定（内部で自動的にモードを選択）
lineChart.setDateRange('2024-01-01', '2024-12-31');
// → 1年モードに自動切り替え

// データを設定
lineChart.setData([100, 150, 200, 180, 250, ...]);

chart.render();
```

## メリット

1. **シンプルなAPI**
   - 最初の日と最後の日を指定するだけ
   - ラベルの配列を生成する必要がない

2. **自動最適化**
   - 期間に応じて最適な表示モードを自動選択
   - ユーザーが手動でモードを選択する必要がない

3. **一貫性**
   - 同じ期間なら常に同じ表示形式
   - 予測可能な動作

4. **保守性**
   - モード判定ロジックを内部に隠蔽
   - 将来的にモードを追加・変更しやすい

## 実装の優先順位

1. **Phase 1: 基本実装**
   - `setDateRange()`メソッドの実装
   - 期間計算ロジック
   - モード判定ロジック

2. **Phase 2: 各モードの実装**
   - 1ヶ月モード
   - 1年モード
   - 1年以上モード

3. **Phase 3: 3ヶ月モード**
   - 3ヶ月モードの詳細設計と実装

4. **Phase 4: カスタマイズ**
   - モードの手動指定（オプション）
   - モード判定の閾値の調整（オプション）

