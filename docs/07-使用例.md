# 使用例

## 基本的な使い方

### HTMLでの使用

```html
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChartCanvas サンプル</title>
    <script src="./chartcanvas.js"></script>
    <script>
        // DOMが読み込まれた後に実行
        window.addEventListener('DOMContentLoaded', () => {
            const chart_div = document.getElementById('chart_div');
            const chart = new ChartCanvas(chart_div);
            chart.size(1024, 600);  // サイズを指定
            const lineChart = chart.addLineChart();
            chart.render();
        });
    </script>
</head>
<body>
    <h1>Sample</h1>
    <div id="chart_div"></div>
</body>
</html>
```

## API設計

### 基本パターン
```javascript
// DOM要素を取得
const chart_div = document.getElementById('chart_div');

// ChartCanvasインスタンスを作成
const chart = new ChartCanvas(chart_div);

// サイズを指定（SVGとコンテナのサイズを設定）
chart.size(1024, 600);

// グラフタイプを追加
const lineChart = chart.addLineChart();

// レンダリング
chart.render();
```

### コンストラクタ
```javascript
new ChartCanvas(containerElement)
```
- `containerElement`: DOM要素（HTMLElement）を直接渡す

## 使用例のバリエーション

### 例1: 折れ線グラフ
```javascript
const chart_div = document.getElementById('chart_div');
const chart = new ChartCanvas(chart_div);
const lineChart = chart.addLineChart();
// lineChartにデータやオプションを設定（詳細は要検討）
chart.render();
```

### 例2: 棒グラフ
```javascript
const chart_div = document.getElementById('chart_div');
const chart = new ChartCanvas(chart_div);
const barChart = chart.addBarChart();
chart.render();
```

### 例3: 複数のグラフを追加
```javascript
const chart_div = document.getElementById('chart_div');
const chart = new ChartCanvas(chart_div);
const lineChart = chart.addLineChart();
const barChart = chart.addBarChart();
chart.render();
```

### 例4: データの設定（要検討）
```javascript
const chart_div = document.getElementById('chart_div');
const chart = new ChartCanvas(chart_div);
const lineChart = chart.addLineChart();
// データ設定の方法は要検討
// lineChart.setData([...]);
// lineChart.setLabels([...]);
chart.render();
```

### 例5: タイトルとサブタイトルの設定
```javascript
const chart_div = document.getElementById('chart_div');
const chart = new ChartCanvas(chart_div);
chart.size(1024, 600);
const lineChart = chart.addLineChart();

// タイトルとサブタイトルを設定
lineChart.setTitle('全店売上');
lineChart.setSubtitle('2024/01/01 - 2024/12/31');

// または、一度に設定
lineChart.setTitles('全店売上', '2024/01/01 - 2024/12/31');

chart.render();
```

### 例6: 複数の系列と凡例
```javascript
const chart_div = document.getElementById('chart_div');
const chart = new ChartCanvas(chart_div);
chart.size(1024, 600);
const lineChart = chart.addLineChart();

// 複数の系列を設定（自動的に凡例が表示される）
lineChart.setData([
    [100, 150, 200, 180, 250],  // 系列1
    [120, 160, 190, 200, 240]   // 系列2
]);

// 凡例のラベルを指定
lineChart.setLegendLabels(['売上A', '売上B']);

// 凡例の文字列は20字以上は自動的に省略される
// 例: "非常に長いラベル名が20字以上ある場合" → "非常に長いラベル名が20字以上..."

chart.render();
```

### 例7: 円グラフの基本使用
```javascript
const chart_div = document.getElementById('chart_div');
const chart = new ChartCanvas(chart_div);
chart.size(800, 600);
const pieChart = chart.addPieChart();

// データとラベルを設定
pieChart.setData([100, 200, 150, 80], ['商品A', '商品B', '商品C', '商品D']);

// タイトルとサブタイトルを設定
pieChart.setTitle('商品別売上構成比');
pieChart.setSubtitle('2024年度');

// ラベルの表示形式を設定（デフォルト: カテゴリ名とパーセンテージ）
pieChart.setLabelFormat('category-percentage');
// → "商品A (25%)"

// ラベルの配置方法を設定（デフォルト: 自動選択）
pieChart.setLabelPosition('auto');
// → セグメントが大きい場合: 外縁の円弧の中心に中央寄せでラベルを配置
// → セグメントが小さい場合: 引出線（リーダーライン）を出すタイプ

// 凡例は自動的に表示される（円グラフの場合、凡例は必須）

chart.render();
```

### 例8: 円グラフのラベルカスタマイズ
```javascript
const chart_div = document.getElementById('chart_div');
const chart = new ChartCanvas(chart_div);
chart.size(800, 600);
const pieChart = chart.addPieChart();

pieChart.setData([100, 200, 150, 80], ['商品A', '商品B', '商品C', '商品D']);

// カテゴリ名、値、パーセンテージを表示
pieChart.setLabelFormat('category-value-percentage');
// → "商品A: 100 (25%)"

// 外縁の円弧の中心に中央寄せでラベルを配置
pieChart.setLabelPosition('arc-center');
// → 全てのセグメントのラベルを外縁の円弧の中心に配置

// または、引出線（リーダーライン）を出すタイプ
pieChart.setLabelPosition('leader-line');
// → 全てのセグメントのラベルを引出線で表示

// 3%以下のセグメントは小さいと判定（自動選択の場合）
pieChart.setLabelThreshold(3);

// 「その他」カテゴリにまとめる機能を有効化
pieChart.setOthersCategory(true, 5, 'その他');
// → 5%以下のセグメントを「その他」カテゴリにまとめる
// → 「その他」カテゴリは350度付近（北西）に配置される
// → これにより、ラベルの数を減らし、見やすさが向上する
// → 特に180度付近（南）でのラベルの重なりを回避できる

chart.render();
```

### 例8-1: 「その他」カテゴリの使用例
```javascript
const chart_div = document.getElementById('chart_div');
const chart = new ChartCanvas(chart_div);
chart.size(800, 600);
const pieChart = chart.addPieChart();

// 多くの小さいセグメントを含むデータ
pieChart.setData([100, 200, 150, 80, 50, 30, 20, 15, 10, 5], 
                 ['商品A', '商品B', '商品C', '商品D', '商品E', '商品F', '商品G', '商品H', '商品I', '商品J']);

// 「その他」カテゴリにまとめる機能を有効化（5%以下のセグメントをまとめる）
pieChart.setOthersCategory(true, 5, 'その他');
// → 商品E, F, G, H, I, Jが「その他」カテゴリにまとめられる
// → 「その他」カテゴリは350度付近（北西）に配置される
// → ラベルの数が減り、見やすさが向上する
// → 180度付近（南）でのラベルの重なりを回避できる

chart.render();
```

### 例9: 2つの円グラフを横並びに配置
```javascript
const chart_div = document.getElementById('chart_div');
const chart = new ChartCanvas(chart_div);
chart.size(1200, 600);  // 横長のサイズ

// 1つ目の円グラフ
const pieChart1 = chart.addPieChart();
pieChart1.setData([100, 200, 150], ['商品A', '商品B', '商品C']);
pieChart1.setTitle('2023年度');

// 2つ目の円グラフ
const pieChart2 = chart.addPieChart();
pieChart2.setData([120, 180, 200], ['商品A', '商品B', '商品C']);
pieChart2.setTitle('2024年度');

// レイアウトを設定（横並び）
chart.setLayout('horizontal');
// → 2つの円グラフが横に並んで表示される
// → 各円グラフの下に凡例が表示される

chart.render();
```

### 例10: 2つの円グラフを縦並びに配置
```javascript
const chart_div = document.getElementById('chart_div');
const chart = new ChartCanvas(chart_div);
chart.size(800, 1200);  // 縦長のサイズ

const pieChart1 = chart.addPieChart();
pieChart1.setData([100, 200, 150], ['商品A', '商品B', '商品C']);
pieChart1.setTitle('2023年度');

const pieChart2 = chart.addPieChart();
pieChart2.setData([120, 180, 200], ['商品A', '商品B', '商品C']);
pieChart2.setTitle('2024年度');

// レイアウトを設定（縦並び）
chart.setLayout('vertical');
// → 2つの円グラフが縦に並んで表示される

chart.render();
```

### 例11: 3つの円グラフを横に3つ並べる
```javascript
const chart_div = document.getElementById('chart_div');
const chart = new ChartCanvas(chart_div);
chart.size(1500, 600);  // 横長のサイズ

// 3つの円グラフを追加
const pieChart1 = chart.addPieChart();
pieChart1.setData([100, 200], ['商品A', '商品B']);
pieChart1.setTitle('2022年度');

const pieChart2 = chart.addPieChart();
pieChart2.setData([120, 180], ['商品A', '商品B']);
pieChart2.setTitle('2023年度');

const pieChart3 = chart.addPieChart();
pieChart3.setData([150, 200], ['商品A', '商品B']);
pieChart3.setTitle('2024年度');

// レイアウトを設定（横並び）
chart.setLayout('horizontal');
// → 3つの円グラフが横に並んで表示される
// → 各円グラフの下に凡例が表示される

chart.render();
```

### 例12: 4つの円グラフを2x2のグリッド状に配置（上下に2つずつ）
```javascript
const chart_div = document.getElementById('chart_div');
const chart = new ChartCanvas(chart_div);
chart.size(1200, 1200);

// 4つの円グラフを追加
const pieChart1 = chart.addPieChart();
pieChart1.setData([100, 200], ['商品A', '商品B']);
pieChart1.setTitle('2021年度');

const pieChart2 = chart.addPieChart();
pieChart2.setData([120, 180], ['商品A', '商品B']);
pieChart2.setTitle('2022年度');

const pieChart3 = chart.addPieChart();
pieChart3.setData([150, 160], ['商品A', '商品B']);
pieChart3.setTitle('2023年度');

const pieChart4 = chart.addPieChart();
pieChart4.setData([180, 200], ['商品A', '商品B']);
pieChart4.setTitle('2024年度');

// レイアウトを設定（横並び - 4つの場合は自動的に2x2グリッド）
chart.setLayout('horizontal');
// → 4つの円グラフが2x2のグリッド状に配置される（上下に2つずつ）
// → 各円グラフの下に凡例が表示される
// → 全ての円グラフが同じサイズに統一される（一番小さなものに合わせる）

// または、自動レイアウト（推奨）
chart.setLayout('auto');
// → グラフの数に応じて自動的に最適なレイアウトを選択
// → 全ての円グラフが同じサイズに統一される

chart.render();
```

## ChartCanvasクラスのメソッド

### グラフ追加メソッド
- `addLineChart()` - 折れ線グラフを追加（戻り値: LineChartインスタンス）
- `addBarChart()` - 棒グラフを追加（戻り値: BarChartインスタンス）
- `addPieChart()` - 円グラフを追加（戻り値: PieChartインスタンス）
- `addScatterChart()` - 散布図を追加（戻り値: ScatterChartインスタンス）

### その他のメソッド（要検討）
- `render()` - グラフを描画（SVGを生成してコンテナに表示）
- `downloadSVG(filename)` - SVGファイルとしてダウンロード
- `getSVG()` - SVG文字列を取得
- `clear()` - すべてのグラフをクリア

## 各グラフタイプのメソッド（要検討）

各グラフタイプ（LineChart, BarChartなど）に以下のようなメソッドがある可能性：

- `setData(data)` - データを設定
- `setLabels(labels)` - ラベルを設定
- `setOptions(options)` - オプションを設定
- `setColor(color)` - 色を設定

## 設定オプションの候補（要検討）

```javascript
// グラフタイプごとのオプション例
{
    data: number[],
    labels: string[],
    color: string,
    width: number,
    height: number,
    title: string,
    xAxis: { label: string },
    yAxis: { label: string }
}
```

## 実装時の注意点

- `<script>`タグは`<body>`の最後に配置するか、`DOMContentLoaded`イベントを使用する
- DOM要素が存在することを確認してから`ChartCanvas`を初期化する

