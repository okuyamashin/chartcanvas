# UI設計

## 画面構成
（ここに画面構成を記載）

## レイアウト

### グラフと凡例のレイアウト

**凡例の配置:**
- デフォルト: グラフの右側に配置
- グラフ描画エリアと凡例の幅の配分（動的調整）:
  - **グラフ描画エリア:** Y軸ラベルと凡例の幅を除いた残りの幅を使用
  - **凡例:** グラフ幅の20%以下に制限（最大200px）、文字列は20字以上は省略
  - **Y軸ラベル:** 文字長に応じて自動調整
  - **グラフ描画エリアの最小幅:** グラフ幅の50%以上を確保

**凡例の幅の問題:**
- 凡例に文字列が含まれるため、文字列の長さによってグラフの横幅が圧迫される可能性がある
- **解決策:**
  - 凡例の最大幅を制限（グラフ幅の20%以下、または最大200px）
  - 文字列が長い場合、省略記号（...）で表示
  - グラフエリアの最小幅を確保（グラフ幅の70%以上）

**レイアウト例:**
```
┌─────────────────────────────────────────────────────────┐
│                    グラフタイトル                        │
│              グラフサブタイトル（オプション）            │
├─────────────────────────────────────────────────────────┤
│                                                          │
│  Y軸   ┌──────────────────────────────┐  │ 凡例      │
│  ラ    │                              │  │ 系列1     │
│  ベ    │        グラフ描画エリア       │  │ 系列2     │
│  ル    │    (動的に幅が調整される)      │  │ 系列3     │
│        │                              │  │           │
│        └──────────────────────────────┘  │ (幅の20%以下)│
│              X軸ラベル                   │            │
└─────────────────────────────────────────────────────────┘
```

**グラフ描画エリアの動的な幅調整:**
- Y軸ラベルの文字長に応じて、左側のマージンが自動調整される
- 凡例の文字長（20字以上は省略）に応じて、右側のマージンが自動調整される
- グラフ描画エリアの幅 = グラフ全体の幅 - Y軸ラベルの幅 - 凡例の幅 - その他のマージン
- グラフ描画エリアの最小幅: グラフ幅の50%以上

**グラフの高さの動的な調整:**
- タイトルとサブタイトルの行数に応じて、タイトル領域の高さが調整される
- X軸ラベルの行数（階層表示の場合は2行）に応じて、X軸ラベル領域の高さが調整される
- グラフ描画エリアの高さ = グラフ全体の高さ - タイトル領域の高さ - X軸ラベル領域の高さ - その他のマージン

### 複数の円グラフのレイアウト

**円グラフを複数並べる使い方がよくあります。**
- 1つ: 単一表示
- 2つ: 横並び（または縦並び）
- 3つ: 横に3つ並べる
- 4つ: 2x2のグリッド（上下に2つずつ）
- **4つ以上は想定していません**（見づらくて使いにくいため）

#### 2つの円グラフを横並びに配置

**レイアウト例:**
```
┌─────────────────────────────────────────────────────────┐
│                    グラフタイトル                        │
│              グラフサブタイトル（オプション）            │
├─────────────────────────────────────────────────────────┤
│                                                          │
│  ┌──────────────────┐    ┌──────────────────┐        │
│  │                  │    │                  │        │
│  │   円グラフ1      │    │   円グラフ2      │        │
│  │                  │    │                  │        │
│  └──────────────────┘    └──────────────────┘        │
│        凡例1                   凡例2                   │
└─────────────────────────────────────────────────────────┘
```

**配置方法:**
- 2つの円グラフを横に並べて配置
- 各円グラフの下に凡例を配置
- 各円グラフのサイズは、グラフ全体の幅を2等分（マージンを除く）

#### 2つの円グラフを縦並びに配置

**レイアウト例:**
```
┌─────────────────────────────────────────────────────────┐
│                    グラフタイトル                        │
│              グラフサブタイトル（オプション）            │
├─────────────────────────────────────────────────────────┤
│                                                          │
│  ┌──────────────────┐                                  │
│  │                  │                                  │
│  │   円グラフ1      │                                  │
│  │                  │                                  │
│  └──────────────────┘                                  │
│        凡例1                                            │
│                                                          │
│  ┌──────────────────┐                                  │
│  │                  │                                  │
│  │   円グラフ2      │                                  │
│  │                  │                                  │
│  └──────────────────┘                                  │
│        凡例2                                            │
└─────────────────────────────────────────────────────────┘
```

**配置方法:**
- 2つの円グラフを縦に並べて配置
- 各円グラフの下に凡例を配置
- 各円グラフのサイズは、グラフ全体の高さを2等分（マージンとタイトル領域を除く）

#### 3つの円グラフを横に3つ並べる

**レイアウト例:**
```
┌─────────────────────────────────────────────────────────┐
│                    グラフタイトル                        │
├─────────────────────────────────────────────────────────┤
│                                                          │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐            │
│  │          │  │          │  │          │            │
│  │ 円グラフ1│  │ 円グラフ2│  │ 円グラフ3│            │
│  │          │  │          │  │          │            │
│  └──────────┘  └──────────┘  └──────────┘            │
│    凡例1        凡例2        凡例3                    │
└─────────────────────────────────────────────────────────┘
```

**配置方法:**
- 3つの円グラフを横に並べて配置
- 各円グラフの下に凡例を配置
- 各円グラフのサイズは、グラフ全体の幅を3等分（マージンを除く）

#### 4つの円グラフを2x2のグリッド状に配置（上下に2つずつ）

**レイアウト例:**
```
┌─────────────────────────────────────────────────────────┐
│                    グラフタイトル                        │
├─────────────────────────────────────────────────────────┤
│                                                          │
│  ┌──────────────┐    ┌──────────────┐                │
│  │              │    │              │                │
│  │  円グラフ1   │    │  円グラフ2   │                │
│  │              │    │              │                │
│  └──────────────┘    └──────────────┘                │
│        凡例1                   凡例2                   │
│                                                          │
│  ┌──────────────┐    ┌──────────────┐                │
│  │              │    │              │                │
│  │  円グラフ3   │    │  円グラフ4   │                │
│  │              │    │              │                │
│  └──────────────┘    └──────────────┘                │
│        凡例3                   凡例4                   │
└─────────────────────────────────────────────────────────┘
```

**配置方法:**
- 4つの円グラフを2x2のグリッド状に配置（上下に2つずつ）
- 各円グラフの下に凡例を配置
- 各円グラフのサイズは、グラフ全体の幅と高さを2等分（マージンを除く）
- **4つ以上は想定していません**（見づらくて使いにくいため）

#### 円グラフのサイズと配置の自動調整

**重要:** 複数の円グラフを並べる場合、全ての円グラフを同じサイズにするために、一番小さなものに合わせます。

**サイズ計算の手順:**
1. 各円グラフのラベル（タイトル、サブタイトル、凡例など）のサイズを計算
2. ラベルのサイズに応じて、各円グラフの描画エリアのサイズを計算
3. 全ての円グラフの中で、一番小さな描画エリアのサイズを特定
4. 全ての円グラフを、一番小さなサイズに統一

**理由:**
- ラベルの大きさ（タイトル、サブタイトル、凡例の文字数など）によって、円グラフの描画エリアのサイズが変わる
- 複数の円グラフを並べる場合、サイズがバラバラだと見づらい
- 全て同じサイズにすることで、見た目の統一感が保たれる

**サイズ計算の詳細:**

- **1つの円グラフ:**
  - 円グラフのサイズ: グラフ全体のサイズからタイトル領域と凡例領域を除いたサイズ

- **2つの円グラフを横並び:**
  - 各円グラフの幅: (グラフ全体の幅 - マージン) / 2
  - 各円グラフの高さ: グラフ全体の高さ - タイトル領域 - 凡例領域 - マージン
  - **サイズ統一:** 2つの円グラフのうち、ラベル領域が大きい方（描画エリアが小さい方）のサイズに合わせる

- **2つの円グラフを縦並び:**
  - 各円グラフの幅: グラフ全体の幅 - マージン
  - 各円グラフの高さ: (グラフ全体の高さ - タイトル領域 - 凡例領域 - マージン) / 2
  - **サイズ統一:** 2つの円グラフのうち、ラベル領域が大きい方（描画エリアが小さい方）のサイズに合わせる

- **3つの円グラフを横に3つ並べる:**
  - 各円グラフの幅: (グラフ全体の幅 - マージン) / 3
  - 各円グラフの高さ: グラフ全体の高さ - タイトル領域 - 凡例領域 - マージン
  - **サイズ統一:** 3つの円グラフのうち、ラベル領域が一番大きいもの（描画エリアが一番小さいもの）のサイズに合わせる

- **4つの円グラフを2x2のグリッド状に配置:**
  - 各円グラフの幅: (グラフ全体の幅 - マージン) / 2
  - 各円グラフの高さ: (グラフ全体の高さ - タイトル領域 - 凡例領域 - マージン) / 2
  - **サイズ統一:** 4つの円グラフのうち、ラベル領域が一番大きいもの（描画エリアが一番小さいもの）のサイズに合わせる

### 円グラフのラベル表示パターン

**円グラフのラベル表示には、主に2つのパターンがあります：**

#### パターン1: 引出線（リーダーライン）を出すタイプ

```
     ┌─────┐
     │     │
     │  ●──┼── 商品A (25%)
     │     │
     └─────┘
```

- セグメントの外縁からリーダーラインを伸ばしてラベルを表示
- 小さいセグメントでも読みやすい
- どのセグメントに対応するか明確

#### パターン2: 外縁の円弧の中心に中央寄せでラベルを配置

```
     ┌─────┐
     │     │
     │  ●  │
     │商品A │
     │(25%)│
     └─────┘
```

- セグメントの外縁（円弧）の中心角度の位置にラベルを配置
- ラベルは中央寄せで表示
- シンプルで見やすい

**デフォルト: セグメントのサイズに応じて自動選択**
- セグメントが大きい場合: パターン2（外縁の円弧の中心）
- セグメントが小さい場合: パターン1（引出線）

## カラーパレット
- プライマリカラー: （未定）
- セカンダリカラー: （未定）
- アクセントカラー: （未定）

## コンポーネント
- （コンポーネントのリスト）

## レスポンシブ対応
- [ ] デスクトップ
- [ ] タブレット
- [ ] モバイル

