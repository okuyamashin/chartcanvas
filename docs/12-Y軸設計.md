# Y軸設計

## 概要

線グラフ・棒グラフのY軸について、**スケールとラベルの取り方**が重要な問題になります。

Y軸はデータの値を表現するため、適切なスケールとラベルがないと、グラフの意味が正しく伝わりません。

## 問題点

### 1. スケールの決定
- Y軸の最小値と最大値をどう決めるか
- データの範囲に応じた適切なスケールの選択
- ゼロベース（0から始める）かどうか
- データがすべて正の値の場合、0を含めるべきか

### 2. ラベルの間隔と数
- Y軸ラベルをどの間隔で表示するか
- ラベルの数が多すぎると読みづらい
- ラベルの数が少なすぎると情報が不足する
- 適切なラベル間隔の自動計算

### 3. スケールの種類
- 線形スケール（Linear Scale）
- 対数スケール（Logarithmic Scale）
- その他の特殊なスケール

### 4. 自動スケーリング
- データに応じて自動的に最適なスケールを選択
- ユーザーが手動で調整できるか

## 採用方針

### スケールの決定方法

**決定:** データの最小値と最大値に基づいて決定

- データから最小値と最大値を取得
- マイナスの値も含めて、データが全部含まれるようにスケールを決定
- 最小値が0以上の場合: ゼロベース（0から始める）
- 最小値が0未満の場合: 最小値から始める
- 最小値と最大値に少し余裕を持たせて設定

### ラベルの間隔の自動計算

**決定:** データの範囲（最大値 - 最小値）に応じて自動的にラベル間隔を調整

#### パーセンテージの場合
**Y軸がパーセンテージの場合:** 10%刻み

- **データ形式:** デフォルトは0.0〜1.0の値、0〜100の値もサポート可能
  - 詳細は[パーセンテージ形式の検討](./13-パーセンテージ形式の検討.md)を参照
- **デフォルト:** データが0.0〜1.0の範囲にある場合、パーセンテージとして扱う
- **オプション:** 0〜100の値や分子/分母の形式もサポート
- または、ユーザーが明示的にパーセンテージであることを指定可能
- ラベル: `0, 10, 20, 30, 40, 50, 60, 70, 80, 90, 100`（10%刻み、11個）
- ラベル表示: `0%, 10%, 20%, 30%, 40%, 50%, 60%, 70%, 80%, 90%, 100%`

#### 通常の数値の場合
1. **範囲が30以下の場合:** 上2桁まで（1刻み）
   - 例: 最小値-10、最大値20の場合 → `-10, -9, -8, ..., 0, 1, 2, ..., 20`
   - ラベル数: 最大31個

2. **範囲が30超の場合:** 上1桁にする（10刻みなど）
   - 例: 最小値-50、最大値50の場合 → `-50, -40, -30, -20, -10, 0, 10, 20, 30, 40, 50`
   - ラベル数: 11個
   - 例: 最小値0、最大値250の場合 → `0, 50, 100, 150, 200, 250`
   - ラベル数: 6個

#### 実装方針
- 範囲（最大値 - 最小値）が30以下の場合: 間隔 = 1
- 範囲が30超の場合: 間隔を10の倍数で調整
  - 範囲に応じて、10, 20, 50, 100, 200, 500, 1000などから選択
  - ラベル数が30個以下になるように調整
  - 最小値と最大値の両方を含むように調整

#### 例
```javascript
// パーセンテージの場合（デフォルト: 0.0〜1.0の範囲）
setData([0.25, 0.5, 0.75, 0.9]);
// → Y軸ラベル: 0%, 10%, 20%, 30%, 40%, 50%, 60%, 70%, 80%, 90%, 100%（10%刻み）
// → データ表示: 25%, 50%, 75%, 90%

// パーセンテージの場合（オプション: 0〜100の範囲、明示的指定が必要）
setYAxisType('percentage', { format: '0-100' });
setData([25, 50, 75, 90]);
// → Y軸ラベル: 0%, 10%, 20%, 30%, 40%, 50%, 60%, 70%, 80%, 90%, 100%（10%刻み）

// 最小値0、最大値25の場合（範囲25、パーセンテージではない）
setData([10, 15, 20, 25]);
// → Y軸ラベル: 0, 1, 2, 3, ..., 25（1刻み）

// 最小値-10、最大値20の場合（範囲30）
setData([-5, 0, 10, 20]);
// → Y軸ラベル: -10, -9, -8, ..., 0, 1, 2, ..., 20（1刻み）

// 最小値-50、最大値50の場合（範囲100）
setData([-30, 0, 30, 50]);
// → Y軸ラベル: -50, -40, -30, -20, -10, 0, 10, 20, 30, 40, 50（10刻み）

// 最小値0、最大値100の場合（範囲100、パーセンテージではない）
setData([50, 75, 90, 100]);
// → Y軸ラベル: 0, 10, 20, 30, 40, 50, 60, 70, 80, 90, 100（10刻み）

// 最小値0、最大値250の場合（範囲250）
setData([100, 150, 200, 250]);
// → Y軸ラベル: 0, 50, 100, 150, 200, 250（50刻み）

// 最小値-100、最大値100の場合（範囲200）
setData([-50, 0, 50, 100]);
// → Y軸ラベル: -100, -50, 0, 50, 100（50刻み）
```

### ラベル間隔の自動計算アルゴリズム（詳細）

#### ステップ1: 最小値・最大値の取得
- データから最小値と最大値を取得
- 最小値と最大値に少し余裕を持たせてY軸の範囲を設定
  - 例: 最小値の110%、最大値の110%
  - または、最小値-5%、最大値+5%

#### ステップ2: 範囲の計算
- 範囲 = 最大値 - 最小値
- この範囲に基づいて間隔を決定

#### ステップ3: パーセンテージの判定
- **デフォルト:** データが0.0〜1.0の範囲にある場合、パーセンテージとして扱う
- **オプション:** データが0〜100の範囲にある場合、パーセンテージとして扱う（明示的指定が必要）
- または、ユーザーが明示的にパーセンテージであることを指定可能
- パーセンテージの場合: 間隔 = 10（10%刻み）
  - ラベル: `0%, 10%, 20%, 30%, 40%, 50%, 60%, 70%, 80%, 90%, 100%`

#### ステップ4: 間隔の決定（通常の数値の場合）
- **範囲 ≤ 30:** 間隔 = 1（上2桁まで）
- **範囲 > 30:** 間隔を10の倍数で調整
  - ラベル数が30個以下になるように間隔を決定
  - 候補: 10, 20, 50, 100, 200, 500, 1000, 2000, 5000, ...
  - 最小値と最大値の両方を含むように調整

#### ステップ5: ラベルの生成
- **パーセンテージの場合:** 0%から100%まで10%刻みで生成
  - デフォルト: 0.0〜1.0の値を100倍して%表示
  - オプション: 0〜100の値をそのまま%表示
- **通常の数値の場合:**
  - 最小値から開始（または、最小値を含むように間隔の倍数に調整）
  - 間隔ごとにラベルを生成
  - Y軸の最大値まで生成（最大値を含む）

#### 例
```javascript
// 最小値0、最大値25の場合
最小値 = 0
最大値 = 25
範囲 = 25
Y軸最小値 = 0
Y軸最大値 = 25（または少し余裕を持たせて30）
間隔 = 1
ラベル = [0, 1, 2, 3, ..., 25]（26個）

// 最小値-10、最大値20の場合
最小値 = -10
最大値 = 20
範囲 = 30
Y軸最小値 = -10（または少し余裕を持たせて-12）
Y軸最大値 = 20（または少し余裕を持たせて22）
間隔 = 1
ラベル = [-10, -9, -8, ..., 0, 1, 2, ..., 20]（31個）

// 最小値-50、最大値50の場合
最小値 = -50
最大値 = 50
範囲 = 100
Y軸最小値 = -50（または少し余裕を持たせて-55）
Y軸最大値 = 50（または少し余裕を持たせて55）
間隔 = 10
ラベル = [-50, -40, -30, -20, -10, 0, 10, 20, 30, 40, 50]（11個）

// 最小値0、最大値250の場合
最小値 = 0
最大値 = 250
範囲 = 250
Y軸最小値 = 0
Y軸最大値 = 250（または少し余裕を持たせて275）
間隔 = 50
ラベル = [0, 50, 100, 150, 200, 250]（6個）

// 最小値-100、最大値100の場合
最小値 = -100
最大値 = 100
範囲 = 200
Y軸最小値 = -100（または少し余裕を持たせて-110）
Y軸最大値 = 100（または少し余裕を持たせて110）
間隔 = 50
ラベル = [-100, -50, 0, 50, 100]（5個）
```

### スケールの種類（要検討）

#### 線形スケール（Linear Scale）
- 最も一般的なスケール
- 等間隔で値を表示
- デフォルトとして採用

#### 対数スケール（Logarithmic Scale）
- データの範囲が非常に広い場合に有効
- 例: 1, 10, 100, 1000, 10000
- オプション機能として実装

## API設計の候補

### 案1: 自動スケーリング（デフォルト）
```javascript
lineChart.setData([100, 150, 200, 180, 250]);
// → Y軸の範囲とラベルを自動計算
```

### 案2: 手動で範囲を指定
```javascript
lineChart.setYAxisRange(0, 300);
// → Y軸の最小値と最大値を指定
```

### 案3: オプションで制御
```javascript
lineChart.setYAxisOptions({
    min: 0,        // 最小値（未指定の場合は自動）
    max: 300,      // 最大値（未指定の場合は自動）
    zeroBased: true,  // ゼロベースにするか
    scale: 'linear'   // 'linear' または 'log'
});
```

## 実装の優先順位

### Phase 1: 基本実装（最優先）
1. **最小値・最大値の取得**
   - データから最小値と最大値を取得
   - マイナスの値も含めて、データが全部含まれるようにスケールを決定

2. **ラベル間隔の自動計算**
   - **パーセンテージの場合:** 10%刻み（0%, 10%, 20%, ..., 100%）
   - **通常の数値の場合:**
     - 範囲（最大値 - 最小値）が30以下の場合: 1刻み（上2桁まで）
     - 範囲が30超の場合: 10の倍数で間隔を調整（上1桁）
     - ラベル数が30個以下になるように調整
     - 最小値と最大値の両方を含むように調整

3. **ラベルの自動生成**
   - 計算した間隔に基づいてラベルを生成
   - 最小値から開始して最大値まで（または、最小値と最大値を含むように調整）

### Phase 3: カスタマイズ
1. Y軸の範囲を手動で指定
2. ラベル間隔の調整
3. ラベルのフォーマット（例: 1000 → 1K）

### Phase 4: 高度な機能
1. 対数スケール
2. その他の特殊なスケール

## 注意事項

- **Y軸はデータの解釈に直結する**
  - 不適切なスケールは、データの意味を誤解させる可能性がある
  - 特に棒グラフでは、ゼロベースが重要

- **ラベルの可読性**
  - ラベルが多すぎると読みづらい
  - ラベルが少なすぎると情報が不足
  - 適切なバランスが重要

- **自動スケーリングの精度**
  - データに応じて適切なスケールを自動選択するアルゴリズムが重要
  - ユーザーが手動で調整できることも重要

