# 機能要件

## 必須機能
- [ ] ラベル機能（最優先）
  - X軸ラベル（カテゴリラベル）
  - Y軸ラベル（値ラベル）
  - 軸タイトル（X軸、Y軸）
  - グラフタイトル
  - **グラフサブタイトル**（必須）
    - タイトルの下に表示される補足情報
    - 例: "2024/01/01 - 2024/12/31"（日付範囲など）
  - **X軸ラベルの自動間引き**（必須）
    - ラベルが多すぎる場合（例: 1年分の日付）、自動的に間引いて表示
    - Chart.jsと同様の動作
    - ラベルが重ならないように適切な間隔で表示
  - **日付ラベルの階層表示**（必須）
    - 日付ラベルの場合、縦書きではなく階層的な表示を行う
    - **1年分の日付:** 例: `2024/01 02 03 04 05 06 07 08 09 10 11 12 2025/01 02`
      - 年を大きく表示し、その年の月を横に並べて表示
      - すべて通常のフォントサイズ
    - **1ヶ月分の日付:** 例: `2025/10/01 02 03 04 05 06 07 08 09 10 11 12 13 14 15 ...`
      - 年/月を大きく表示し、その月の日を横に並べて表示
      - すべて通常のフォントサイズ
    - **3年分など長期間の日付:**
      - 最初の年/月だけ通常のフォントサイズ（例: `2020/01`）
      - 残りの月/日は小さなフォントサイズ（例: `02 03 04 05 06 07 08 09 10 11 12`）
      - 次の年の最初の月は再び通常サイズ
      - ラベルが被ることを防ぎ、スペースを節約しつつ読みやすくする
    - 縦書き（90度回転）は読みづらいため、この方式を採用
  - **重要:** ラベルはグラフの線よりも重要です
  - **凡例（Legend）**（必須）
    - 複数の系列がある場合に自動表示
    - **配置: グラフの右側に配置**（一般的な配置方法）
      - Chart.jsのようにタイトルとグラフの間に配置するのではなく、一般的な右側配置を採用
      - グラフエリアを広く使えるため、データの可読性が向上
    - 各系列の色とラベルを表示
    - オプションで配置位置を変更可能（上、下、左、右）
    - **凡例の文字列は20字以上は省略**（必須）
      - 文字列が20字以上の場合、省略記号（...）で表示
  - **グラフ描画エリアの動的な幅調整**（必須）
    - Y軸ラベルの文字長と凡例の文字長によって、グラフの描画エリア（幅）が動的に変化する
    - Y軸ラベルの最大文字長を計算し、左側のマージンを自動調整
    - 凡例の文字長（20字以上は省略）を計算し、右側のマージンを自動調整
    - グラフ描画エリアの最小幅: グラフ幅の50%以上
  - **グラフの高さの動的な調整**（必須）
    - 高さは比較的固定だが、タイトルとX軸ラベルの文字の大きさで変化する
    - タイトルとサブタイトルの行数に応じて、タイトル領域の高さを調整
    - X軸ラベルの行数（階層表示の場合は2行）に応じて、X軸ラベル領域の高さを調整
- [ ] グラフの描画機能
- [ ] SVG出力機能

## オプション機能
- [ ] （機能1）
- [ ] （機能2）

## グラフの種類
- [ ] 折れ線グラフ
- [ ] 棒グラフ
- [ ] 円グラフ
  - **円グラフのラベル**（必須）
    - 各セグメント（扇形）にラベルを表示
    - ラベルの内容: カテゴリ名とパーセンテージ（デフォルト）
    - **ラベルの配置方法: 2つのパターンをサポート**
      - **パターン1: 引出線（リーダーライン）を出すタイプ**
        - セグメントの外縁からリーダーラインを伸ばしてラベルを表示
        - 小さいセグメントでも読みやすい
      - **パターン2: 外縁の円弧の中心に中央寄せでラベルを配置**
        - セグメントの外縁（円弧）の中心角度の位置にラベルを配置
        - ラベルは中央寄せで表示
        - シンプルで見やすい
    - **デフォルト: セグメントのサイズに応じて自動選択**
      - セグメントが大きい場合: 外縁の円弧の中心に中央寄せでラベルを配置（パターン2）
      - セグメントが小さい場合: 引出線（リーダーライン）を出すタイプ（パターン1）
    - ユーザーが明示的にパターン1またはパターン2を選択可能
    - **ラベルの位置を自動的に調整する**（必須）
      - Chart.jsの課題（ラベルの位置が手動設定）を解決
      - ラベルが重なる場合、自動的に位置を調整して重なりを回避
      - **180度付近（南）での文字の重なりを特に注意して回避**
      - ユーザーが手動で位置を設定する必要がない
    - **「その他」カテゴリのサポート**（推奨）
      - 小さいセグメントを自動的に「その他」カテゴリにまとめる機能
      - 閾値（例: 5%以下）を設定して、小さいセグメントを「その他」にまとめる
      - **350度付近（北西）に「その他」カテゴリを配置することを推奨**
      - これにより、ラベルの数を減らし、見やすさが向上する
      - 特に180度付近（南）でのラベルの重なりを回避できる
    - 凡例は必須（円グラフの場合）
    - **複数の円グラフを並べる機能**（必須）
      - 1つ: 単一表示
      - 2つ: 横並び（または縦並び）
      - 3つ: 横に3つ並べる
      - 4つ: 2x2のグリッド（上下に2つずつ）
      - **4つ以上は想定していません**（見づらくて使いにくいため）
      - 各円グラフの下に凡例を配置
      - **全ての円グラフを同じサイズにする**（必須）
        - ラベルの大きさ（タイトル、サブタイトル、凡例の文字数など）によって、各円グラフの描画エリアのサイズが変わる
        - 複数の円グラフを並べる場合、全ての円グラフの中で、一番小さな描画エリアのサイズに統一する
        - これにより、見た目の統一感が保たれる
- [ ] 散布図
- [ ] その他（ ）

## データ入力方法
- [ ] CSVファイル読み込み
- [ ] JSONファイル読み込み
- [ ] 手動入力
- [ ] API連携
- [ ] その他（ ）

## X軸の日付範囲指定
- [x] 最初の日と最後の日を指定する方式
  - `setDateRange(startDate, endDate)`メソッド
  - 内部で期間に応じて自動的にモードを切り替え
  - モード: 1ヶ月、3ヶ月、1年、1年以上

## 出力形式
- [x] SVG画像（単一ファイルとしてダウンロード可能）

## Y軸のスケールとラベル
- [x] データの最小値と最大値を取得
- [x] マイナスの値も含めて、データが全部含まれるようにスケールを決定
- [x] 最小値が0以上の場合: ゼロベース（0から始める）
- [x] 最小値が0未満の場合: 最小値から始める
- [x] **パーセンテージの場合:** データが0〜100の範囲にある場合、10%刻みでラベルを生成（0%, 10%, 20%, ..., 100%）
- [x] **通常の数値の場合:**
  - 範囲（最大値 - 最小値）が30以下の場合: 上2桁まで（1刻み）
  - 範囲が30超の場合: 上1桁にする（10の倍数で間隔を調整）
  - ラベル数が30個以下になるように自動調整
  - 最小値と最大値の両方を含むようにラベルを生成

